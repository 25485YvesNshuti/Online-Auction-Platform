<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Reset Password</title>
    <link rel="stylesheet" th:href="@{/css/auth.css}" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script>
        function togglePassword(id, iconId) {
            var input = document.getElementById(id);
            var icon = document.getElementById(iconId);
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'üôà';
            } else {
                input.type = 'password';
                icon.textContent = 'üëÅÔ∏è';
            }
        }
        function checkStrength(pw) {
            if (!pw) return {strength: '', color: '', percent: 0};
            if (pw.length < 6) return {strength: 'Weak', color: '#ef4444', percent: 25};
            if (pw.length < 8) return {strength: 'Fair', color: '#f59e42', percent: 50};
            if (pw.length < 12) return {strength: 'Good', color: '#3b82f6', percent: 75};
            return {strength: 'Strong', color: '#22c55e', percent: 100};
        }
        function updateStrength() {
            var pw = document.getElementById('newPassword').value;
            var s = checkStrength(pw);
            document.getElementById('pwStrength').textContent = s.strength;
            document.getElementById('pwStrength').style.color = s.color;
            document.getElementById('pwStrengthBar').style.width = s.percent + '%';
            document.getElementById('pwStrengthBar').style.background = s.color;
        }
        function checkMatch() {
            var pw = document.getElementById('newPassword').value;
            var cpw = document.getElementById('confirmPassword').value;
            var match = pw && cpw && pw === cpw;
            document.getElementById('matchMsg').textContent = match ? 'Passwords match' : (cpw ? 'Passwords do not match' : '');
            document.getElementById('matchMsg').style.color = match ? '#22c55e' : '#ef4444';
            document.getElementById('resetBtn').disabled = !match || pw.length < 8;
        }
    </script>
</head>
<body style="background: #f7f8fa; font-family: 'Inter', Arial, sans-serif; margin: 0;">
    <div style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
        <div style="background: #fff; border-radius: 18px; box-shadow: 0 4px 24px rgba(0,0,0,0.08); padding: 32px 24px; max-width: 380px; width: 100%;">
            <div style="text-align: center; margin-bottom: 24px;">
                <div style="display: inline-flex; align-items: center; justify-content: center; background: #dbeafe; border-radius: 50%; padding: 18px; margin-bottom: 12px;">
                    <span style="font-size: 2.2rem; color: #2563eb;">üîë</span>
                </div>
                <h1 style="color: #10162f; margin: 0 0 8px 0; font-size: 1.4rem; font-weight: 700;">Create New Password</h1>
                <p style="color: #555;">Your new password must be different from previous passwords</p>
            </div>
            <form th:action="@{/reset-password}" method="post" class="space-y-4" autocomplete="off">
                <div th:if="${error}" style="color:#ef4444; margin-bottom:12px; text-align:center;">[[${error}]]</div>
                <div th:if="${success}" style="color:#22c55e; margin-bottom:12px; text-align:center;">[[${success}]]</div>
                <div style="margin-bottom: 18px;">
                    <label for="email" style="display:block; color:#222; margin-bottom:4px;">Email</label>
                    <input id="email" name="email" type="email" th:value="${email}" required placeholder="Enter your email" style="width:100%; box-sizing:border-box;" />
                </div>
                <div style="margin-bottom: 18px;">
                    <label for="newPassword" style="display:block; color:#222; margin-bottom:4px;">New Password</label>
                    <div style="position:relative; width:100%; margin:0 auto;">
                        <input id="newPassword" name="newPassword" type="password" required placeholder="Enter new password" style="width:100%; padding-right:38px; box-sizing:border-box;" oninput="updateStrength();checkMatch();" />
                        <button type="button" onclick="togglePassword('newPassword','pwIcon')" style="position:absolute;right:0;top:0;height:100%;width:38px;display:flex;align-items:center;justify-content:center;background:none;border:none;cursor:pointer;padding:0;" tabindex="-1"><span id="pwIcon">üëÅÔ∏è</span></button>
                    </div>
                    <div style="margin-top:8px; width:100%; margin-left:auto; margin-right:auto;">
                        <div style="display:flex;justify-content:space-between;margin-bottom:2px;">
                            <span style="color:#555;">Password Strength</span>
                            <span id="pwStrength" style="font-weight:600;"></span>
                        </div>
                        <div style="height:6px;background:#e5e7eb;border-radius:4px;overflow:hidden;">
                            <div id="pwStrengthBar" style="height:100%;width:0;background:#e5e7eb;transition:width 0.3s;"></div>
                        </div>
                    </div>
                </div>
                <div style="margin-bottom: 18px;">
                    <label for="confirmPassword" style="display:block; color:#222; margin-bottom:4px;">Confirm Password</label>
                    <div style="position:relative; width:100%; margin:0 auto;">
                        <input id="confirmPassword" name="confirmPassword" type="password" required placeholder="Confirm new password" style="width:100%; padding-right:38px; box-sizing:border-box;" oninput="checkMatch();" />
                        <button type="button" onclick="togglePassword('confirmPassword','cpwIcon')" style="position:absolute;right:0;top:0;height:100%;width:38px;display:flex;align-items:center;justify-content:center;background:none;border:none;cursor:pointer;padding:0;" tabindex="-1"><span id="cpwIcon">üëÅÔ∏è</span></button>
                    </div>
                    <div id="matchMsg" style="margin-top:6px;font-size:0.98rem; width:100%; margin-left:auto; margin-right:auto;"></div>
                </div>
                <div style="background:#f1f5f9;border-radius:8px;padding:12px 16px;margin-bottom:18px;">
                    <div style="color:#222;margin-bottom:6px;">Password Requirements:</div>
                    <ul style="color:#555;list-style:none;padding:0;margin:0;">
                        <li id="req1">‚úì At least 8 characters</li>
                        <li id="req2">‚úì One uppercase letter</li>
                        <li id="req3">‚úì One number</li>
                    </ul>
                </div>
                <button id="resetBtn" type="submit" style="width:100%;background:#2563eb;color:#fff;border:none;border-radius:8px;padding:14px;font-size:1.1rem;font-weight:600;cursor:pointer;opacity:0.95;transition:opacity 0.2s, background 0.2s;" disabled>Reset Password</button>
                <script>
                    document.querySelector('form[th\:action="@{/reset-password}"]').addEventListener('submit', function(e) {
                        var btn = document.getElementById('resetBtn');
                        btn.disabled = true;
                        btn.textContent = 'Please wait...';
                    });
                </script>
            </form>
        </div>
    </div>
    <script>
        document.getElementById('newPassword').addEventListener('input', function() {
            var pw = this.value;
            document.getElementById('req1').style.color = pw.length >= 8 ? '#22c55e' : '#555';
            document.getElementById('req2').style.color = /[A-Z]/.test(pw) ? '#22c55e' : '#555';
            document.getElementById('req3').style.color = /[0-9]/.test(pw) ? '#22c55e' : '#555';
        });
    </script>
</body>
</html>